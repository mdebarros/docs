<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="925px" preserveAspectRatio="none" style="width:996px;height:925px;" version="1.1" viewBox="0 0 996 925" width="996px" zoomAndPan="magnify"><defs><filter height="300%" id="fh2dyeaeyg4n8" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="377" x="306.25" y="23.5352">1.1.3.b. Transfer Handler Consume (batch messages)</text><rect fill="#FFFFE0" height="880.2246" style="stroke: #A80036; stroke-width: 1.0;" width="966.5" x="19" y="34.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="101" x="451.75" y="47.0566">Central Service</text><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="81" y="171.9082"/><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="712.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="457" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="797" y="787.2246"/><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="698.9375" style="stroke: #000000; stroke-width: 2.0;" width="882.5" x="13" y="133.2871"/><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="468.0742" style="stroke: #000000; stroke-width: 2.0;" width="515" x="370.5" y="357.1504"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="86" x2="86" y1="116.2871" y2="849.2246"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="461.5" x2="461.5" y1="116.2871" y2="849.2246"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="665.5" x2="665.5" y1="116.2871" y2="849.2246"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="801.5" x2="801.5" y1="116.2871" y2="849.2246"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="933.5" x2="933.5" y1="116.2871" y2="849.2246"/><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="27" y="76.7988"/><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="23" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="30" y="101.334">Transfer-Topic</text><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="27" y="848.2246"/><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="23" y="852.2246"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="30" y="872.7598">Transfer-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="380.5" y="113.334">Transfer Event Handler</text><ellipse cx="462" cy="83.7988" fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="458,71.7988,464,66.7988,462,71.7988,464,76.7988,458,71.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="157" x="380.5" y="861.7598">Transfer Event Handler</text><ellipse cx="462" cy="880.7129" fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><polygon fill="#A80036" points="458,868.7129,464,863.7129,462,868.7129,464,873.7129,458,868.7129" style="stroke: #A80036; stroke-width: 1.0;"/><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="617.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="613.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="620.5" y="101.334">Event-Topic</text><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="617.5" y="848.2246"/><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="97" x="613.5" y="852.2246"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="83" x="620.5" y="872.7598">Event-Topic</text><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="732.5" y="76.7988"/><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="728.5" y="80.7988"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="735.5" y="101.334">Notification-Topic</text><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="732.5" y="848.2246"/><rect fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="139" x="728.5" y="852.2246"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="125" x="735.5" y="872.7598">Notification-Topic</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="885.5" y="113.334">Central Store</text><path d="M915.5,63.7988 C915.5,53.7988 933.5,53.7988 933.5,53.7988 C933.5,53.7988 951.5,53.7988 951.5,63.7988 L951.5,89.7988 C951.5,99.7988 933.5,99.7988 933.5,99.7988 C933.5,99.7988 915.5,99.7988 915.5,89.7988 L915.5,63.7988 " fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M915.5,63.7988 C915.5,73.7988 933.5,73.7988 933.5,73.7988 C933.5,73.7988 951.5,73.7988 951.5,63.7988 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="90" x="885.5" y="861.7598">Central Store</text><path d="M915.5,874.7129 C915.5,864.7129 933.5,864.7129 933.5,864.7129 C933.5,864.7129 951.5,864.7129 951.5,874.7129 L951.5,900.7129 C951.5,910.7129 933.5,910.7129 933.5,910.7129 C933.5,910.7129 915.5,910.7129 915.5,900.7129 L915.5,874.7129 " fill="#FEFECE" filter="url(#fh2dyeaeyg4n8)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M915.5,874.7129 C915.5,884.7129 933.5,884.7129 933.5,884.7129 C933.5,884.7129 951.5,884.7129 951.5,874.7129 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="81" y="171.9082"/><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="712.9375" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="457" y="126.2871"/><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="30" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="797" y="787.2246"/><path d="M13,133.2871 L241,133.2871 L241,140.2871 L231,150.2871 L13,150.2871 L13,133.2871 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="698.9375" style="stroke: #000000; stroke-width: 2.0;" width="882.5" x="13" y="133.2871"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="183" x="28" y="146.8555">Transfer Handler Consume</text><polygon fill="#A80036" points="102,167.9082,92,171.9082,102,175.9082,98,171.9082" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="96" x2="456" y1="171.9082" y2="171.9082"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="108" y="167.166">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="334" x="121" y="167.166">Consume Transfer event batch of messages for Payer</text><polygon fill="#A80036" points="654,252.2188,664,256.2188,654,260.2188,658,256.2188" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="467" x2="660" y1="256.2188" y2="256.2188"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="474" y="251.4766">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="487" y="251.4766">Publish event information</text><rect fill="#FFFFFF" filter="url(#fh2dyeaeyg4n8)" height="55.9316" style="stroke: #000000; stroke-width: 2.0;" width="340" x="377.5" y="264.2188"/><polygon fill="#EEEEEE" points="377.5,264.2188,441.5,264.2188,441.5,271.2188,431.5,281.2188,377.5,281.2188,377.5,264.2188" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="390.5" y="278.7871">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="448.5" y="297.7871">Event Handler Consume {</text><a target="_top" xlink:actuate="onRequest" xlink:href="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:show="new" xlink:title="https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg" xlink:type="simple"><text fill="#0000FF" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="underline" textLength="36" x="606.5" y="297.7871">9.1.0.</text><line style="stroke: #0000FF; stroke-width: 1.0;" x1="606.5" x2="642.5" y1="299.7871" y2="299.7871"/></a><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="642.5" y="297.7871">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="452.5" y="313.0977"/><path d="M370.5,357.1504 L444.5,357.1504 L444.5,364.1504 L434.5,374.1504 L370.5,374.1504 L370.5,357.1504 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="468.0742" style="stroke: #000000; stroke-width: 2.0;" width="515" x="370.5" y="357.1504"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="29" x="385.5" y="370.7188">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="155" x="459.5" y="369.7852">[for each message in batch]</text><path d="M472,379.4609 L472,756.4609 L734,756.4609 L734,389.4609 L724,379.4609 L472,379.4609 " fill="#FFFF00" filter="url(#fh2dyeaeyg4n8)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M724,379.4609 L724,389.4609 L734,389.4609 L724,379.4609 " fill="#FFFF00" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="478" y="397.0293">Message:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="478" y="412.3398">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="494" y="427.6504">id: &lt;transferMessage.transferId&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="225" x="494" y="442.9609">from: &lt;transferMessage.payerFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="210" x="494" y="458.2715">to: &lt;transferMessage.payeeFsp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="139" x="494" y="473.582">type: application/json</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="494" y="488.8926">content: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="510" y="504.2031">headers: &lt;transferHeaders&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="510" y="519.5137">payload: &lt;transferMessage&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="494" y="534.8242">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="70" x="494" y="550.1348">metadata: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="510" y="565.4453">event: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="526" y="580.7559">id: &lt;uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="526" y="596.0664">responseTo: &lt;previous.uuid&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="526" y="611.377">type: notification,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="526" y="626.6875">action: prepare,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="526" y="641.998">createdAt: &lt;timestamp&gt;,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="43" x="526" y="657.3086">state: {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="542" y="672.6191">status: "success",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="46" x="542" y="687.9297">code: 0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="526" y="703.2402">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="510" y="718.5508">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="494" y="733.8613">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="478" y="749.1719">}</text><polygon fill="#A80036" points="785,783.2246,795,787.2246,785,791.2246,789,787.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="467" x2="791" y1="787.2246" y2="787.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="9" x="474" y="782.4824">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="487" y="782.4824">Publish Notification event for Payee</text><!--
@startuml
title 1.1.3.b. Transfer Handler Consume (batch messages)

autonumber


collections "Transfer-Topic" as TOPIC_TRANSFERS
control "Transfer Event Handler" as TRANS_HANDLER
collections "Event-Topic" as TOPIC_EVENTS
collections "Notification-Topic" as TOPIC_NOTIFICATIONS
database "Central Store" as DB

box "Central Service" #LightYellow
    participant TOPIC_TRANSFERS
    participant TRANS_HANDLER
    participant TOPIC_EVENTS
    participant TOPIC_NOTIFICATIONS
    participant DB
end box

activate TRANS_HANDLER
group Transfer Handler Consume
    TOPIC_TRANSFERS <- TRANS_HANDLER: Consume Transfer event batch of messages for Payer
    activate TOPIC_TRANSFERS
    deactivate TOPIC_TRANSFERS
    
    |||
    TRANS_HANDLER -> TOPIC_EVENTS: Publish event information
    ref over TRANS_HANDLER, TOPIC_EVENTS :  Event Handler Consume {[[https://github.com/mojaloop/docs/blob/master/CentralServices/seq_diagrams/seq-event-9.1.0.svg 9.1.0.]]} \n
    |||


    loop for each message in batch
        note right of TRANS_HANDLER #yellow
            Message:
            {
                id: <transferMessage.transferId>
                from: <transferMessage.payerFsp>,
                to: <transferMessage.payeeFsp>,
                type: application/json
                content: {
                    headers: <transferHeaders>,
                    payload: <transferMessage>
                },
                metadata: {
                    event: {
                        id: <uuid>,
                        responseTo: <previous.uuid>,
                        type: notification,
                        action: prepare,
                        createdAt: <timestamp>,
                        state: {
                            status: "success",
                            code: 0
                        }
                    }
                }
            }
        end note
        TRANS_HANDLER -> TOPIC_NOTIFICATIONS: Publish Notification event for Payee
        activate TOPIC_NOTIFICATIONS
        deactivate TOPIC_NOTIFICATIONS
    end
end
deactivate TRANS_HANDLER
@enduml

PlantUML version 1.2018.11(Sat Sep 22 18:43:53 SAST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_152-release-1343-b26
Operating System: Mac OS X
OS Version: 10.14.2
Default Encoding: UTF-8
Language: en
Country: ZA
--></g></svg>